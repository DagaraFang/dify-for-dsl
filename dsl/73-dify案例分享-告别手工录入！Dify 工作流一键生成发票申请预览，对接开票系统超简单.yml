app:
  description: ''
  icon: 🤖
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: 73-dify案例分享-告别手工录入！Dify 工作流一键生成发票申请预览，对接开票系统超简单
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai_api_compatible:0.0.16@77274df8fe2632cac66bfd153fcc75aa5e96abbe92b5c611b8984ad9f4cd4457
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/modelscope:0.0.4@5a3245e52b864fa8a20686baf5add2f5517eae5f11f94419bf46edbe170731e8
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: qiangxinglin/excel_tools:0.0.1@e6019557a12b0d8436ed924532d043c691504a872e18120a12d79e1b2225628e
kind: app
version: 0.3.0
workflow:
  conversation_variables: []
  environment_variables:
  - description: ''
    id: 8242c2c4-14e0-4535-a983-029cdd354880
    name: apikey
    selector:
    - env
    - apikey
    value: sk-zhouhui1122444
    value_type: string
  - description: ''
    id: 1dcac405-bb64-402f-9d2e-80e8192fc3ae
    name: apiurl
    selector:
    - env
    - apiurl
    value: http://14.103.204.132:8080/generate-html/
    value_type: string
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 500
        batch_count_limit: 10
        file_size_limit: 100
        image_file_size_limit: 100
        video_file_size_limit: 500
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: tool
      id: 1754359998615-source-1754379634717-target
      source: '1754359998615'
      sourceHandle: source
      target: '1754379634717'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: tool
        targetType: llm
      id: 1754379634717-source-1754379696135-target
      source: '1754379634717'
      sourceHandle: source
      target: '1754379696135'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 1754379696135-source-1754383424904-target
      source: '1754379696135'
      sourceHandle: source
      target: '1754383424904'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1754383424904-source-1754384870547-target
      source: '1754383424904'
      sourceHandle: source
      target: '1754384870547'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: answer
      id: 1754384870547-source-answer-target
      source: '1754384870547'
      sourceHandle: source
      target: answer
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: 开始
        type: start
        variables:
        - allowed_file_extensions: []
          allowed_file_types:
          - document
          allowed_file_upload_methods:
          - local_file
          - remote_url
          label: 文档
          max_length: 48
          options: []
          required: true
          type: file
          variable: file
      height: 89
      id: '1754359998615'
      position:
        x: -25
        y: 308
      positionAbsolute:
        x: -25
        y: 308
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '---- 发票申请单JSON数据

          {{#1754379696135.text#}}

          --- 发票开具预览展示HTML代码

          {{#1754383424904.text#}}

          --- 生成HTML展示

          {{#1754384870547.html_url#}}

          {{#1754384870547.markdown_result#}}'
        desc: ''
        selected: false
        title: 直接回复
        type: answer
        variables: []
      height: 193
      id: answer
      position:
        x: 1715
        y: 308
      positionAbsolute:
        x: 1715
        y: 308
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        is_team_authorization: true
        output_schema: null
        paramSchemas:
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Upload file.
            ja_JP: Upload file.
            pt_BR: Upload file.
            zh_Hans: 上传的文件.
          label:
            en_US: File
            ja_JP: File
            pt_BR: File
            zh_Hans: 文件
          llm_description: Upload file.
          max: null
          min: null
          name: file
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: file
        params:
          file: ''
        provider_id: qiangxinglin/excel_tools/excel_tools
        provider_name: qiangxinglin/excel_tools/excel_tools
        provider_type: builtin
        selected: false
        title: Excel转Json
        tool_configurations: {}
        tool_description: 将Excel转换为Json。
        tool_label: Excel转Json
        tool_name: excel2json
        tool_parameters:
          file:
            type: variable
            value:
            - '1754359998615'
            - file
        type: tool
        version: '2'
      height: 85
      id: '1754379634717'
      position:
        x: 279
        y: 308
      positionAbsolute:
        x: 279
        y: 308
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: Qwen/Qwen3-Coder-30B-A3B-Instruct
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: 7caf47a0-9c06-4ef5-a213-98161b8d4258
          role: system
          text: "# Role: 发票申请单信息提取专家\n\n## Profile\n\n- Author: 财务数据处理专家\n- Version:\
            \ 1.0\n- Language: 中文\n- Description: 专门从发票申请单数据中提取关键信息，用于后续开具发票的AI助手\n\
            \n## Skills\n\n1. 精确识别和提取发票申请单中的基础信息\n2. 准确解析商品明细和税务计算数据\n3. 标准化输出格式，确保数据完整性\n\
            4. 验证数据逻辑一致性和合规性\n\n## Rules\n\n1. 必须严格按照发票申请单的标准格式进行信息提取\n2. 确保所有金额计算准确无误\n\
            3. 保持原始数据的完整性，不得随意修改\n4. 对于缺失或异常数据，必须明确标注\n5. 输出格式必须标准化，便于后续发票开具系统使用\n\
            \n## Workflow\n\n1. **基础信息识别**：提取申请单头部的基本信息\n2. **开票方信息提取**：获取开票公司相关信息\n\
            3. **付款方信息提取**：获取付款单位的完整信息\n4. **商品明细解析**：逐行提取商品信息和税务数据\n5. **合计信息验证**：核算总金额和税额\n\
            6. **数据补全处理**：对于多张申请单，如有缺失的付款单位信息，从第一张完整申请单中补全\n7. **格式化输出**：按标准格式整理所有提取信息\n\
            \n## OutputFormat\n\n```json\n{\n  \"发票申请单信息\": {\n    \"申请日期\": \"YYYY-MM-DD\"\
            ,\n    \"申请人\": \"姓名\",\n    \"发票类别\": \"专用发票/普通发票\",\n    \"开票公司信息\"\
            : {\n      \"公司名称\": \"开票公司名称\",\n      \"税务登记号\": \"统一社会信用代码\",\n   \
            \   \"地址及电话\": \"详细地址和联系电话\",\n      \"开户行及账号\": \"银行全称和账号\"\n    },\n\
            \    \"付款单位信息\": {\n      \"公司名称\": \"付款单位全称\",\n      \"税务登记号\": \"统一社会信用代码\"\
            ,\n      \"地址及电话\": \"详细地址和联系电话\",\n      \"开户行及账号\": \"银行全称和账号\"\n  \
            \  },\n    \"商品明细\": [\n      {\n        \"序号\": 1,\n        \"应税劳务名称\"\
            : \"商品/服务名称\",\n        \"规格型号\": \"具体规格\",\n        \"单位\": \"计量单位\"\
            ,\n        \"数量\": \"数值\",\n        \"单价不含税\": \"数值\",\n        \"金额不含税\"\
            : \"数值\",\n        \"税率\": \"税率数值\",\n        \"税额\": \"税额数值\"\n     \
            \ }\n    ],\n    \"合计信息\": {\n      \"不含税金额合计\": \"数值\",\n      \"税额合计\"\
            : \"数值\",\n      \"价税合计\": \"数值\",\n      \"大写金额\": \"中文大写金额\"\n    },\n\
            \    \"其他信息\": {\n      \"财务负责人\": \"姓名\",\n      \"领票人\": \"姓名\",\n \
            \     \"开票人\": \"姓名\",\n      \"开票日期\": \"YYYY-MM-DD\",\n      \"发票号码\"\
            : \"发票号码\",\n      \"备注\": \"备注信息\"\n    }\n  }\n}\n```\n\n## Initialization\n\
            \n作为发票申请单信息提取专家，我将帮助您从发票申请单数据中准确提取所有必要信息，确保后续发票开具的准确性和合规性。\n\n请提供需要处理的发票申请单数据，我将按照标准格式为您提取并整理所有关键信息。\n\
            \n## 提取规则说明\n\n### 1. 数据识别规则\n- **应税劳务名称**：以\"*\"开头和结尾的分类标识，如\"*文具*\"\
            、\"*计算机外部设备*\"\n- **金额计算**：确保\"金额(不含税) = 数量 × 单价(不含税)\"\n- **税额计算**：确保\"\
            税额 = 金额(不含税) × 税率\"\n- **合计验证**：验证各项合计数据的准确性\n\n### 2. 格式标准化\n- **日期格式**：统一为YYYY-MM-DD格式\n\
            - **金额格式**：保留小数点后2位\n- **税率格式**：以小数形式表示（如0.13表示13%）\n\n### 3. 数据完整性检查\n\
            - 确保所有必填字段都有数据\n- 对于空值或异常值进行标注\n- 验证税务登记号格式的正确性\n- 检查银行账号信息的完整性\n- 当同一批次中有多张发票申请单时，如果后续申请单缺少付款单位信息，自动从第一张完整的申请单中补全相关信息\n\
            \n### 4. 多申请单处理\n- 当一个文件包含多张申请单时，分别提取每张申请单的信息\n- 为每张申请单分配唯一标识\n- 保持各申请单数据的独立性"
        - id: 69c0b89f-de94-4f5c-8abd-0af3e76ac635
          role: user
          text: 请根据用户上传的发票申请单{{#1754379634717.text#}} 返回发票填开的必要发票信息JSON格式数据
        selected: false
        title: 发票申请单信息提取专家
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1754379696135'
      position:
        x: 632
        y: 308
      positionAbsolute:
        x: 632
        y: 308
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: deepseek-ai/DeepSeek-V3
          provider: langgenius/modelscope/modelscope
        prompt_template:
        - id: 274afeef-eba3-4b0e-85d2-7cf653bdf392
          role: system
          text: "# Role: 发票预览HTML生成专家\n\n## Profile\n\n- Author: 智能发票系统专家\n- Version:\
            \ 3.0\n- Language: 中文\n- Description: 专门基于发票申请单JSON数据生成专业、美观的发票预览HTML页面的AI专家，完美支持多发票展示、响应式设计和中国增值税发票标准格式\n\
            \n## Skills\n\n1. 精确解析发票申请单JSON数据结构，支持多发票数据处理\n2. 生成符合中国增值税发票标准的HTML页面布局\n\
            3. 创建响应式、美观的发票预览界面，支持标签页切换\n4. 优化打印样式和用户体验，确保专业外观\n5. 实现CSS纯净切换功能，无需JavaScript依赖\n\
            6. 智能格式化金额、税率、日期等财务数据\n\n## Rules\n\n1. 必须严格按照中国增值税发票的标准格式生成HTML\n2. 确保所有金额、税率、税额的显示格式正确（保留两位小数，添加千位分隔符）\n\
            3. 支持多张发票的标签页切换预览功能，使用CSS radio按钮实现\n4. 保持界面美观、专业，符合财务系统标准\n5. 生成的HTML必须包含完整的内联CSS样式\n\
            6. 确保打印友好的样式设计\n7. 应税劳务名称中的分类标识（如*公共安全设备*）需要高亮显示\n8. 自动补全缺失信息，如日期默认为当前日期\n\
            \n## Workflow\n\n1. **JSON数据解析**：\n   - 解析\"发票申请单信息\"数组，识别发票数量\n   - 提取每张发票的完整信息结构\n\
            \   - 验证数据完整性和格式正确性\n\n2. **多发票结构设计**：\n   - 如果有多张发票，生成标签页切换结构\n   - 使用CSS\
            \ radio按钮实现无JavaScript切换\n   - 为每张发票分配唯一ID和标签\n\n3. **HTML结构生成**：\n  \
            \ - 创建完整的HTML5文档结构\n   - 生成发票预览容器和卡片布局\n   - 构建标准的增值税发票格式\n\n4. **数据填充与格式化**：\n\
            \   - 将JSON数据准确填充到HTML模板\n   - 格式化金额（添加¥符号和千位分隔符）\n   - 转换税率为百分比显示\n \
            \  - 处理应税劳务名称的分类高亮\n\n5. **样式优化**：\n   - 应用专业的CSS样式\n   - 确保响应式设计\n  \
            \ - 优化打印样式\n\n## JSON数据结构规范\n\n期望的输入JSON格式：\n```json\n{\n  \"发票申请单信息\"\
            : [\n    {\n      \"申请日期\": \"2024-02-05\",\n      \"申请人\": \"赵孟鑫\",\n\
            \      \"发票类别\": \"专用发票\",\n      \"开票公司信息\": {\n        \"公司名称\": \"\
            新疆文旅资本控股有限公司\",\n        \"税务登记号\": \"统一社会信用代码\",\n        \"地址及电话\":\
            \ \"详细地址和联系电话\",\n        \"开户行及账号\": \"银行全称和账号\"\n      },\n      \"\
            付款单位信息\": {\n        \"公司名称\": \"新旅昌吉文化旅游开发有限公司\",\n        \"税务登记号\"\
            : \"91652300MADG6Y4P0B\",\n        \"地址及电话\": \"地址信息\",\n        \"开户行及账号\"\
            : \"银行账号信息\"\n      },\n      \"商品明细\": [\n        {\n          \"序号\"\
            : 1,\n          \"应税劳务名称\": \"*公共安全设备*援邦 干粉灭火器...\",\n          \"规格型号\"\
            : \"YB-35KG\",\n          \"单位\": \"个\",\n          \"数量\": \"10\",\n\
            \          \"单价不含税\": \"460.18\",\n          \"金额不含税\": \"4601.77\",\n\
            \          \"税率\": \"0.13\",\n          \"税额\": \"598.23\"\n        }\n\
            \      ],\n      \"合计信息\": {\n        \"不含税金额合计\": \"52389.38\",\n   \
            \     \"税额合计\": \"6810.62\",\n        \"价税合计\": \"59200.00\",\n      \
            \  \"大写金额\": \"伍万玖仟贰佰元整\"\n      },\n      \"其他信息\": {\n        \"财务负责人\"\
            : null,\n        \"领票人\": \"赵孟鑫\",\n        \"开票人\": null,\n        \"\
            开票日期\": \"2024-02-05\",\n        \"发票号码\": null,\n        \"备注\": null\n\
            \      }\n    }\n  ]\n}\n```\n\n## OutputFormat\n\n生成完整的HTML页面，包含以下结构：\n\
            \n```html\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"\
            UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\
            >\n    <title>发票预览 - 智能发票系统</title>\n    <style>\n        /* 完整的内联CSS样式\
            \ */\n    </style>\n</head>\n<body>\n    <div class=\"invoice-preview-container\"\
            >\n        <!-- 多发票标签页（如果有多张发票） -->\n        <!-- 发票预览内容 -->\n    </div>\n\
            </body>\n</html>\n```\n\n## CSS样式规范\n\n### 1. 核心样式变量\n```css\n:root {\n\
            \    --primary-color: #3498db;\n    --primary-dark: #2980b9;\n    --text-color:\
            \ #2c3e50;\n    --border-color: #bdc3c7;\n    --background-color: #f5f5f5;\n\
            \    --card-background: #ffffff;\n    --success-color: #27ae60;\n    --warning-color:\
            \ #f39c12;\n}\n```\n\n### 2. 发票卡片样式\n- 白色背景，深色边框\n- 圆角设计，阴影效果\n- 清晰的信息分组布局\n\
            \n### 3. 标签页切换样式\n- 使用CSS radio按钮实现\n- 蓝色主题，选中状态高亮\n- 平滑的切换效果\n\n### 4.\
            \ 表格样式\n- 标准的发票表格布局\n- 交替行颜色\n- 清晰的边框和对齐\n\n### 5. 响应式设计\n- 移动端适配\n- 打印样式优化\n\
            - 字体大小自适应\n\n## 数据处理规则\n\n### 1. 金额格式化\n```javascript\n// 示例：52389.38\
            \ → ¥52,389.38\nfunction formatAmount(amount) {\n    return `¥${parseFloat(amount).toLocaleString('zh-CN',\
            \ {\n        minimumFractionDigits: 2,\n        maximumFractionDigits:\
            \ 2\n    })}`;\n}\n```\n\n### 2. 税率处理\n```javascript\n// 示例：0.13 → 13%\n\
            function formatTaxRate(rate) {\n    return `${(parseFloat(rate) * 100).toFixed(0)}%`;\n\
            }\n```\n\n### 3. 应税劳务名称处理\n```javascript\n// 示例：*公共安全设备*援邦 干粉灭火器\n// 输出：<span\
            \ class=\"item-category\">*公共安全设备*</span>援邦 干粉灭火器\nfunction formatItemName(name)\
            \ {\n    return name.replace(/\\*([^*]+)\\*/g, '<span class=\"item-category\"\
            >*$1*</span>');\n}\n```\n\n### 4. 日期处理\n- 空值或null显示为当前日期\n- 统一格式：YYYY-MM-DD\n\
            - 中文日期格式支持\n\n## 多发票支持特性\n\n### 1. 标签页结构\n```html\n<!-- 隐藏的radio按钮控制切换\
            \ -->\n<input type=\"radio\" id=\"invoice-radio-0\" name=\"invoice-tabs\"\
            \ checked style=\"display: none;\">\n<input type=\"radio\" id=\"invoice-radio-1\"\
            \ name=\"invoice-tabs\" style=\"display: none;\">\n\n<!-- 标签页按钮 -->\n\
            <div class=\"invoice-tabs\">\n    <label for=\"invoice-radio-0\" class=\"\
            tab-button\">发票 1 - 专用发票</label>\n    <label for=\"invoice-radio-1\" class=\"\
            tab-button\">发票 2 - 专用发票</label>\n</div>\n\n<!-- 发票内容 -->\n<div class=\"\
            invoice-cards\">\n    <div class=\"invoice-card\" id=\"invoice-0\">...</div>\n\
            \    <div class=\"invoice-card\" id=\"invoice-1\">...</div>\n</div>\n\
            ```\n\n### 2. CSS切换逻辑\n```css\n/* 默认隐藏所有发票 */\n.invoice-card { display:\
            \ none; }\n\n/* 显示选中的发票 */\n#invoice-radio-0:checked ~ .invoice-cards\
            \ #invoice-0 { display: block !important; }\n#invoice-radio-1:checked\
            \ ~ .invoice-cards #invoice-1 { display: block !important; }\n\n/* 标签页选中状态\
            \ */\n#invoice-radio-0:checked ~ .invoice-tabs label[for=\"invoice-radio-0\"\
            ] {\n    background: var(--primary-color) !important;\n    color: white\
            \ !important;\n}\n```\n\n## 发票布局结构\n\n### 1. 发票头部\n- 发票类型标题（增值税专用发票/普通发票）\n\
            - 发票编号（自动生成）\n- 渐变背景设计\n\n### 2. 公司信息区域\n- 购买方信息卡片（左侧）\n- 销售方信息卡片（右侧）\n\
            - 图标标识和清晰布局\n\n### 3. 商品明细表格\n- 标准8列布局\n- 应税劳务名称分类高亮\n- 金额和税率格式化显示\n\n\
            ### 4. 合计信息区域\n- 不含税金额、税额、价税合计\n- 大写金额显示\n- 突出的总计样式\n\n### 5. 发票底部\n-\
            \ 开票人、复核人、收款人信息\n- 图标标识\n- 专业的底部布局\n\n## 打印优化\n\n### 1. 打印媒体查询\n```css\n\
            @media print {\n    .invoice-tabs { display: none !important; }\n    .invoice-card\
            \ { \n        display: block !important; \n        page-break-after: always;\n\
            \        box-shadow: none;\n        border: 2px solid #000;\n    }\n \
            \   body { background: white !important; }\n}\n```\n\n### 2. 打印友好特性\n\
            - 移除不必要的装饰元素\n- 确保黑白打印效果\n- 每张发票独立分页\n- 优化字体大小和间距\n\n## 错误处理\n\n### 1.\
            \ 数据验证\n- 检查JSON格式正确性\n- 验证必要字段存在\n- 处理空值和异常数据\n\n### 2. 容错机制\n- 缺失数据的默认值处理\n\
            - 格式错误的自动修正\n- 友好的错误提示\n\n### 3. 兼容性处理\n- 支持不同版本的JSON结构\n- 向后兼容性保证\n-\
            \ 浏览器兼容性优化\n\n## Initialization\n\n作为发票预览HTML生成专家，我将根据您提供的发票申请单JSON数据，生成专业、美观、符合中国增值税发票标准的HTML预览页面。\n\
            \n我的核心能力包括：\n1. \U0001F3AF **精确解析**：准确解析复杂的JSON数据结构\n2. \U0001F4C4 **标准格式**：严格按照中国增值税发票格式生成\n\
            3. \U0001F504 **多发票支持**：完美支持多张发票的标签页切换\n4. \U0001F4B0 **智能格式化**：自动格式化金额、税率、日期等数据\n\
            5. \U0001F3A8 **专业样式**：美观的界面设计和响应式布局\n6. \U0001F5A8️ **打印优化**：专门优化的打印样式\n\
            \n请提供需要处理的JSON数据，我将生成完整的HTML发票预览页面！\n\n## Example Usage\n\n**输入示例**：\n\
            ```json\n{\n  \"发票申请单信息\": [\n    {\n      \"申请人\": \"赵孟鑫\",\n      \"\
            发票类别\": \"专用发票\",\n      \"开票公司信息\": {\n        \"公司名称\": \"新疆文旅资本控股有限公司\"\
            \n      },\n      \"付款单位信息\": {\n        \"公司名称\": \"新旅昌吉文化旅游开发有限公司\"\
            ,\n        \"税务登记号\": \"91652300MADG6Y4P0B\"\n      },\n      \"商品明细\"\
            : [...],\n      \"合计信息\": {...}\n    }\n  ]\n}\n```\n\n**输出**：完整的HTML发票预览页面，包含：\n\
            - 完整的HTML5文档结构\n- 内联CSS样式\n- 多发票标签页切换功能\n- 专业的发票布局\n- 格式化的数据显示\n- 打印优化样式\n\
            \n## Advanced Features\n\n1. **智能数据补全**：自动补全缺失的日期、编号等信息\n2. **动态样式适配**：根据发票数量自动调整布局\n\
            3. **数据验证提示**：检测并提示数据异常\n4. **可访问性支持**：支持键盘导航和屏幕阅读器\n5. **性能优化**：高效的CSS渲染和最小化的DOM结构\n\
            6. **国际化准备**：预留多语言支持接口\n\n现在请提供您的JSON数据，我将为您生成专业的发票预览HTML页面！"
        - id: 50bb945a-0b2b-4be5-8499-b4050219efa9
          role: user
          text: 请基于大模型输出{{#1754379696135.text#}}格式的数据生成HTML代码
        selected: true
        title: 发票预览HTML生成专家
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1754383424904'
      position:
        x: 1000
        y: 308
      positionAbsolute:
        x: 1000
        y: 308
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import json\nimport re\nimport time\nimport requests\n\ndef main(json_html:\
          \ str, apikey: str,apiurl: str) -> dict:\n    try:\n        # 去除输入字符串中的\
          \ ```html 和 ``` 标记\n        match = re.search(r'```html\\s*([\\s\\S]*?)```',\
          \ json_html, re.DOTALL)\n        \n        if match:\n            # group(1)\
          \ 获取第一个捕获组的内容，即纯HTML代码\n            # .strip() 去除可能存在的前后空白\n           \
          \ html_content = match.group(1).strip()\n        else:\n            # 如果在输入中找不到HTML代码块，则返回错误\n\
          \            raise ValueError(\"未能在输入中找到 ```html ... ``` 代码块。\")\n     \
          \   \n        # 生成时间戳，确保文件名唯一\n        timestamp = int(time.time())\n  \
          \      filename = f\"makehtml_{timestamp}.html\"\n        \n        # API端点（假设本地运行）\n\
          \        url = f\"{apiurl}\"\n        \n        # 请求数据\n        payload\
          \ = {\n            \"html_content\": html_content,\n            \"filename\"\
          : filename  # 使用传入的文件名\n        }\n        \n        # 设置请求头（包含认证token）\n\
          \        headers = {\n            \"Authorization\": f\"Bearer {apikey}\"\
          ,  # 替换为实际的认证token\n            \"Content-Type\": \"application/json\"\n\
          \        }\n        \n        try:\n            # 发送POST请求\n           \
          \ response = requests.post(url, json=payload, headers=headers)\n       \
          \     \n            # 检查响应状态\n            if response.status_code == 200:\n\
          \                result = response.json()\n                html_url = result.get(\"\
          html_url\", \"\")\n                generated_filename = result.get(\"filename\"\
          , \"\")\n                \n                # 返回结果\n                return\
          \ {\n                    \"html_url\": html_url,\n                    \"\
          filename\": generated_filename,\n                    \"markdown_result\"\
          :  f\"[点击查看]({html_url})\"\n                }\n            else:\n     \
          \           raise Exception(f\"HTTP Error: {response.status_code}, Message:\
          \ {response.text}\")\n        \n        except requests.exceptions.RequestException\
          \ as e:\n            raise Exception(f\"Request failed: {str(e)}\")\n  \
          \  \n    except Exception as e:\n        return {\n            \"error\"\
          : f\"Error: {str(e)}\"\n        }"
        code_language: python3
        desc: ''
        outputs:
          filename:
            children: null
            type: string
          html_url:
            children: null
            type: string
          markdown_result:
            children: null
            type: string
        selected: false
        title: 代码执行
        type: code
        variables:
        - value_selector:
          - '1754383424904'
          - text
          value_type: string
          variable: json_html
        - value_selector:
          - env
          - apikey
          value_type: string
          variable: apikey
        - value_selector:
          - env
          - apiurl
          value_type: string
          variable: apiurl
      height: 53
      id: '1754384870547'
      position:
        x: 1304
        y: 308
      positionAbsolute:
        x: 1304
        y: 308
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: -38.99605673852193
      y: -104.562255612635
      zoom: 1
